/*!
 * jQuery UI date range picker widget
 * Copyright (c) 2017 Tamble, Inc.
 * Licensed under MIT (https://github.com/tamble/jquery-ui-daterangepicker/raw/master/LICENSE.txt)
 *
 * Depends:
 *   - jQuery 1.8.3+
 *   - jQuery UI 1.9.0+ (widget factory, position utility, button, menu, datepicker)
 *   - moment.js 2.3.0+
 */
 !function(t,e,n){var a=0;function o(e,a,o){var r,i,c;return r=t("<div></div>").addClass(e+"-presets"),i=t("<ul></ul>"),c=t.ui.menu.prototype.options.items===n?{start:'<li><a href="#">',end:"</a></li>"}:{start:"<li><div>",end:"</div></li>"},t.each(a.presetRanges,function(){t(c.start+this.text+c.end).data("dateStart",this.dateStart).data("dateEnd",this.dateEnd).click(o).appendTo(i)}),r.append(i),i.menu().data("ui-menu").delay=0,{getElement:function(){return r}}}t.widget("comiseo.daterangepicker",{version:"0.6.0-beta.1",options:{presetRanges:[{text:"Today",dateStart:function(){return moment()},dateEnd:function(){return moment()}},{text:"Yesterday",dateStart:function(){return moment().subtract("days",1)},dateEnd:function(){return moment().subtract("days",1)}},{text:"Last 7 Days",dateStart:function(){return moment().subtract("days",6)},dateEnd:function(){return moment()}},{text:"Last Week (Mo-Su)",dateStart:function(){return moment().subtract("days",7).isoWeekday(1)},dateEnd:function(){return moment().subtract("days",7).isoWeekday(7)}},{text:"Month to Date",dateStart:function(){return moment().startOf("month")},dateEnd:function(){return moment()}},{text:"Previous Month",dateStart:function(){return moment().subtract("month",1).startOf("month")},dateEnd:function(){return moment().subtract("month",1).endOf("month")}},{text:"Year to Date",dateStart:function(){return moment().startOf("year")},dateEnd:function(){return moment()}}],initialText:"Select date range...",icon:"ui-icon-triangle-1-s",applyButtonText:"Apply",clearButtonText:"Clear",cancelButtonText:"Cancel",rangeSplitter:" - ",dateFormat:"M d, yy",altFormat:"yy-mm-dd",verticalOffset:0,mirrorOnCollision:!0,autoFitCalendars:!0,applyOnMenuSelect:!0,open:null,close:null,change:null,clear:null,cancel:null,onOpen:null,onClose:null,onChange:null,onClear:null,datepickerOptions:{numberOfMonths:3,maxDate:0}},_create:function(){this._dateRangePicker=function(n,r,i){var c,s,l,u,d,p,f="comiseo-daterangepicker",g=!1,m=!1,h=0,b=1,y=2,v=3,O=["left","right","top","bottom"],k=b,C=null;function x(){if(i.autoFitCalendars){var n=t(e).width(),a=c.outerWidth(!0),o=d.getElement(),r=o.datepicker("option","numberOfMonths"),s=r;if(a>n){for(;r>1&&c.outerWidth(!0)>n;)o.datepicker("option","numberOfMonths",--r);r!==s&&(x.monthWidth=(a-c.outerWidth(!0))/(s-r))}else for(;r<x.numberOfMonths&&n-c.outerWidth(!0)>=x.monthWidth;)o.datepicker("option","numberOfMonths",++r);_(),m=!1}}function E(e){var n=i.dateFormat;return t.datepicker.formatDate(n,e.start)+(+e.end!=+e.start?i.rangeSplitter+t.datepicker.formatDate(n,e.end):"")}function S(){var t=w();t?(l.setLabel(E(t)),d.setRange(t)):d.reset()}function R(e,a){var o,c,s,u=e||d.getRange();u.start&&(u.end||(u.end=u.start),e&&d.setRange(u),l.setLabel(E(u)),n.val((o=u,c=i.altFormat,s={},s.start=t.datepicker.formatDate(c,o.start),s.end=t.datepicker.formatDate(c,o.end),JSON.stringify(s))).change(),i.onChange&&i.onChange(),r._trigger("change",a,{instance:r}))}function w(){return function(e){var n=i.altFormat,a=null;if(e)try{a=JSON.parse(e,function(e,a){return e?t.datepicker.parseDate(n,a):a})}catch(t){}return a}(n.val())}function T(t){l.reset(),d.reset(),i.onClear&&i.onClear(),r._trigger("clear",t,{instance:r})}function D(e){var n=t(this),a=n.data("dateStart")().startOf("day").toDate(),o=n.data("dateEnd")().startOf("day").toDate();return d.setRange({start:a,end:o}),i.applyOnMenuSelect&&(W(e),R(null,e)),!1}function _(){c.position({my:"left top",at:"left bottom"+(i.verticalOffset<0?i.verticalOffset:"+"+i.verticalOffset),of:l.getElement(),collision:"flipfit flipfit",using:function(t,e){var n,a,o=e.element.left+e.element.width/2,r=e.target.left+e.target.width/2,s=k,p=e.element.top+e.element.height/2,g=e.target.top+e.target.height/2,m=C;(k=o>r?b:h)!==s&&(i.mirrorOnCollision&&(n=k===h?u:d,c.children().first().append(n.getElement())),c.removeClass(f+"-"+O[s]),c.addClass(f+"-"+O[k])),c.css({left:t.left,top:t.top}),(C=p>g?v:y)!==m&&(null!==m&&l.getElement().removeClass(f+"-"+O[m]),l.getElement().addClass(f+"-"+O[C])),a=C===v&&e.element.top-e.target.top!==e.target.height+i.verticalOffset||C===y&&e.target.top-e.element.top!==e.element.height+i.verticalOffset,l.getElement().toggleClass(f+"-vfit",a)}})}function P(t){t.preventDefault(),t.stopPropagation()}function M(e){switch(e.which){case t.ui.keyCode.UP:case t.ui.keyCode.DOWN:return P(e),void B(e);case t.ui.keyCode.ESCAPE:return P(e),W(e),void S();case t.ui.keyCode.TAB:return void W(e)}}function B(t){g||(l.getElement().addClass(f+"-active"),s.show(),g=!0,m&&x(),d.scrollToRangeStart(),c.show(),_()),i.onOpen&&i.onOpen(),r._trigger("open",t,{instance:r})}function W(t){g&&(c.hide(),s.hide(),l.getElement().removeClass(f+"-active"),g=!1),i.onClose&&i.onClose(),r._trigger("close",t,{instance:r})}function F(t){g?(W(t),S()):B(t)}return l=function(e,n,o){var r,i;function c(t){r.button("option","label",t)}return i="drp_autogen"+a++,t('label[for="'+e.attr("id")+'"]').attr("for",i),r=t('<button type="button"></button>').addClass(n+"-triggerbutton").attr({title:e.attr("title"),tabindex:e.attr("tabindex"),id:i}).button({icons:{secondary:o.icon},icon:o.icon,iconPosition:"end",label:o.initialText}),{getElement:function(){return r},getLabel:function(){return r.button("option","label")},setLabel:c,reset:function(){e.val("").change(),c(o.initialText)},enforceOptions:function(){r.button("option",{icons:{secondary:o.icon},icon:o.icon,iconPosition:"end",label:o.initialText})}}}(n,f,i),u=o(f,i,D),d=function(e,n){var a,o={start:null,end:null};function r(e,a){var r=n.datepickerOptions.dateFormat||t.datepicker._defaults.dateFormat,i=t.datepicker.parseDate(r,e);!o.start||o.end?(o.start=i,o.end=null):i<o.start?(o.end=o.start,o.start=i):o.end=i,n.datepickerOptions.hasOwnProperty("onSelect")&&n.datepickerOptions.onSelect(e,a)}function i(t){var e=[!0,o.start&&(+t==+o.start||o.end&&o.start<=t&&t<=o.end)?"ui-state-highlight":""],a=[!0,"",""];return n.datepickerOptions.hasOwnProperty("beforeShowDay")&&(a=n.datepickerOptions.beforeShowDay(t)),[e[0]&&a[0],e[1]+" "+a[1],a[2]]}function c(){a.datepicker("refresh"),a.datepicker("setDate",null)}return(a=t("<div></div>",{class:e+"-calendar ui-widget-content"})).datepicker(t.extend({},n.datepickerOptions,{beforeShowDay:i,onSelect:r})),function t(){setTimeout(function(){c(),t()},moment().endOf("day")-moment())}(),{getElement:function(){return a},scrollToRangeStart:function(){o.start&&a.datepicker("setDate",o.start)},getRange:function(){return o},setRange:function(t){o=t,c()},refresh:c,reset:function(){o={start:null,end:null},c()},enforceOptions:function(){a.datepicker("option",t.extend({},n.datepickerOptions,{beforeShowDay:i,onSelect:r}))}}}(f,i),x.numberOfMonths=i.datepickerOptions.numberOfMonths,x.numberOfMonths instanceof Array&&(i.autoFitCalendars=!1),L=f,A=i,N={onApply:function(t){W(t),R(null,t)},onClear:function(t){W(t),T(t)},onCancel:function(t){r._trigger("cancel",t,{instance:r}),W(t),S()}},J=t("<div></div>").addClass(L+"-buttonpanel"),A.applyButtonText&&(Y=t('<button type="button" class="ui-priority-primary"></button>').text(A.applyButtonText).button(),J.append(Y)),A.clearButtonText&&(j=t('<button type="button" class="ui-priority-secondary"></button>').text(A.clearButtonText).button(),J.append(j)),A.cancelButtonText&&(z=t('<button type="button" class="ui-priority-secondary"></button>').text(A.cancelButtonText).button(),J.append(z)),N&&(Y&&Y.click(N.onApply),j&&j.click(N.onClear),z&&z.click(N.onCancel)),p={getElement:function(){return J},enforceOptions:function(){Y&&Y.button("option","label",A.applyButtonText),j&&j.button("option","label",A.clearButtonText),z&&z.button("option","label",A.cancelButtonText)}},c=t("<div></div>",{class:f+" "+f+"-"+O[k]+" ui-widget ui-widget-content ui-corner-all ui-front"}).append(t("<div></div>",{class:f+"-main ui-widget-content"}).append(u.getElement()).append(d.getElement())).append(t('<div class="ui-helper-clearfix"></div>').append(p.getElement())).hide(),n.hide().after(l.getElement()),s=t("<div></div>",{class:"ui-front "+f+"-mask"}).hide(),t("body").append(s).append(c),x(),S(),l.getElement().click(F),l.getElement().keydown(M),s.click(function(t){W(t),S()}),t(e).resize(function(){g?x():m=!0}),{toggle:F,destroy:function(){c.remove(),l.getElement().remove(),n.show()},open:B,close:W,setRange:R,getRange:w,clearRange:T,reset:S,enforceOptions:function(){var t=u;u=o(f,i,D),t.getElement().replaceWith(u.getElement()),d.enforceOptions(),p.enforceOptions(),l.enforceOptions();var e=w();e&&l.setLabel(E(e))},getContainer:function(){return c}};var L,A,N,J,Y,j,z}(this.element,this,this.options)},_destroy:function(){this._dateRangePicker.destroy()},_setOptions:function(t){this._super(t),this._dateRangePicker.enforceOptions()},open:function(){this._dateRangePicker.open()},close:function(){this._dateRangePicker.close()},setRange:function(t){this._dateRangePicker.setRange(t)},getRange:function(){return this._dateRangePicker.getRange()},clearRange:function(){this._dateRangePicker.clearRange()},widget:function(){return this._dateRangePicker.getContainer()}})}(jQuery,window);
